<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Flui360 - Relatórios e estatísticas de hábitos">
    <title>Flui360 - Relatórios</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body class="pagina-app">
    <!-- Skip link para acessibilidade -->
    <a href="#conteudo-principal" class="skip-link">Pular para o conteúdo principal</a>
    
    <!-- Região de anúncios para leitores de tela -->
    <div id="ariaLiveRegion" class="aria-live-region" aria-live="polite" aria-atomic="true"></div>
    
    <!-- 
        RELATÓRIOS (relatorios.html)
        ============================
        Tela de visualização de estatísticas e gráficos.
        
        FAB GLOBAL:
        - Ao clicar no FAB, abre modal de seleção de tipo de hábito
        - Mesmo fluxo de criação usado em "Meus Hábitos"
    -->

    <div class="sidebar-backdrop" id="sidebarBackdrop"></div>

    <aside class="sidebar" id="sidebar" role="navigation" aria-label="Menu principal">
        <div class="sidebar-header">
            <div class="logo">
                <span class="logo-icone" aria-hidden="true">&#9679;</span>
                <span class="logo-texto">Flui360</span>
            </div>
        </div>
        
        <nav class="sidebar-nav" aria-label="Navegação principal">
            <ul>
                <li>
                    <a href="dashboard.html" class="nav-link">
                        <span class="nav-icone">&#9632;</span>
                        Dashboard
                    </a>
                </li>
                <li>
                    <a href="habitos.html" class="nav-link">
                        <span class="nav-icone">&#10003;</span>
                        Meus Hábitos
                    </a>
                </li>
                <li>
                    <a href="relatorios.html" class="nav-link nav-link-ativo" aria-current="page">
                        <span class="nav-icone">&#9776;</span>
                        Relatórios
                    </a>
                </li>
                <li>
                    <a href="recomendacoes.html" class="nav-link">
                        <span class="nav-icone">&#9733;</span>
                        Recomendações
                    </a>
                </li>
            </ul>
        </nav>

        <div class="sidebar-footer">
            <button type="button" class="nav-link nav-link-preferencias" id="btnAbrirPreferencias">
                <span class="nav-icone">&#9881;</span>
                Preferências
            </button>
            <a href="index.html" class="nav-link nav-sair">
                <span class="nav-icone">&#8592;</span>
                Sair
            </a>
        </div>
    </aside>

    <div class="conteudo-principal" id="conteudo-principal" role="main">
        <header class="header-app">
            <button class="btn-hamburguer" id="btnHamburguer" aria-label="Abrir menu" aria-expanded="false">
                <span class="hamburguer-linha"></span>
                <span class="hamburguer-linha"></span>
                <span class="hamburguer-linha"></span>
            </button>
            
            <div class="header-usuario">
                <span class="saudacao">Olá, <strong>Usuário</strong>!</span>
            </div>
        </header>

        <main class="main-content">
            <div class="header-secao">
                <h1 class="titulo-pagina">Relatórios</h1>
                <p class="subtitulo-pagina">Acompanhe seu progresso</p>
            </div>

            <section class="secao-relatorio">
                <div class="secao-relatorio-header">
                    <h2 class="secao-titulo">Dias Concluídos por Hábito</h2>
                    <button type="button" class="info-icone" aria-label="Explicação do gráfico dias concluídos" aria-expanded="false">
                        &#9432;
                        <span class="info-icone-tooltip">Cada barra mostra quantos dias, no último mês, você completou cada hábito. Quanto maior a barra, mais consistente você foi com esse hábito.</span>
                    </button>
                </div>
                <div class="grafico-horizontal-container" id="graficoDiasConcluidos">
                </div>
            </section>

            <section class="secao-relatorio">
                <div class="secao-relatorio-header">
                    <h2 class="secao-titulo">Taxa de Conclusão Mensal</h2>
                    <button type="button" class="info-icone" aria-label="Explicação do gráfico de taxa de conclusão" aria-expanded="false">
                        &#9432;
                        <span class="info-icone-tooltip">Mostra a porcentagem de hábitos concluídos em cada semana do mês. Uma tendência crescente indica melhora na consistência.</span>
                    </button>
                </div>
                <div class="grafico-container">
                    <div class="grafico-barras grafico-mensal" id="graficoMensal">
                    </div>
                    <div class="grafico-legenda grafico-legenda-mensal" id="legendaMensal">
                    </div>
                </div>
            </section>

            <section class="secao-relatorio">
                <h2 class="secao-titulo">Resumo do Mês</h2>
                <div class="estatisticas-grid">
                    <div class="estatistica-item">
                        <span class="estatistica-valor" id="totalDiasAtivos">24</span>
                        <span class="estatistica-label">Dias Ativos</span>
                    </div>
                    <div class="estatistica-item">
                        <span class="estatistica-valor" id="melhorSequencia">12</span>
                        <span class="estatistica-label">Melhor Sequência</span>
                    </div>
                    <div class="estatistica-item">
                        <span class="estatistica-valor" id="habitosConcluidos">87</span>
                        <span class="estatistica-label">Hábitos Concluídos</span>
                    </div>
                    <div class="estatistica-item">
                        <span class="estatistica-valor" id="mediaDiaria">3.6</span>
                        <span class="estatistica-label">Média Diária</span>
                    </div>
                </div>
            </section>
        </main>

        <button class="fab" id="btnNovoHabito" aria-label="Adicionar novo hábito">
            <span>+</span>
        </button>
    </div>

    <!-- MODAL: SELEÇÃO DE TIPO DE HÁBITO -->
    <div class="modal-backdrop" id="modalTipoBackdrop">
        <div class="modal modal-pequeno" role="dialog" aria-labelledby="tituloModalTipo" aria-modal="true">
            <div class="modal-header">
                <h2 id="tituloModalTipo">Escolha o Tipo de Hábito</h2>
                <button type="button" class="btn-fechar-modal" id="btnFecharModalTipo" aria-label="Fechar modal">
                    &times;
                </button>
            </div>
            <div class="modal-body">
                <p class="modal-descricao">Selecione como você deseja acompanhar este hábito:</p>
                <div class="tipo-habito-opcoes">
                    <button type="button" class="tipo-habito-btn" data-tipo="binario">
                        <span class="tipo-icone">&#10003;</span>
                        <span class="tipo-nome">Sim ou Não</span>
                        <span class="tipo-descricao">Ideal para hábitos que você simplesmente faz ou não faz. Ex: Meditar, Tomar vitamina, Acordar cedo.</span>
                    </button>
                    <button type="button" class="tipo-habito-btn" data-tipo="mensuravel">
                        <span class="tipo-icone">&#9776;</span>
                        <span class="tipo-nome">Mensurável</span>
                        <span class="tipo-descricao">Para hábitos com quantidade. Ex: Beber 2L de água, Ler 30 páginas, Caminhar 5km.</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: FORMULÁRIO PRINCIPAL DE HÁBITO -->
    <div class="modal-backdrop" id="modalHabitoBackdrop">
        <div class="modal modal-habito modal-habito-avancado" role="dialog" aria-labelledby="tituloModalHabito" aria-modal="true">
            <div class="modal-header">
                <h2 id="tituloModalHabito">Novo Hábito</h2>
                <button type="button" class="btn-fechar-modal" id="btnFecharModalHabito" aria-label="Fechar modal">
                    &times;
                </button>
            </div>
            <div class="modal-body">
                <form class="form-habito form-habito-avancado" id="formHabito">
                    <input type="hidden" id="habitoId" value="">
                    <input type="hidden" id="tipoHabitoHidden" value="binario">

                    <div class="form-secao tipo-indicador-secao" id="tipoIndicadorSecao">
                        <div class="tipo-indicador" id="tipoIndicador">
                            <span class="tipo-indicador-icone">&#10003;</span>
                            <span class="tipo-indicador-texto">Hábito Sim/Não</span>
                        </div>
                    </div>

                    <div class="form-secao">
                        <div class="campo-grupo">
                            <label for="nomeHabito">Nome do hábito</label>
                            <input 
                                type="text" 
                                id="nomeHabito" 
                                name="nomeHabito" 
                                placeholder="Ex: Beber água, Meditar, Ler..." 
                                required
                            >
                        </div>
                    </div>

                    <div class="form-secao campos-mensuravel" id="camposMensuravel" style="display: none;">
                        <h3 class="form-secao-titulo">Meta Diária</h3>
                        <div class="campos-linha">
                            <div class="campo-grupo campo-pequeno">
                                <label for="alvoDiario">Alvo</label>
                                <input type="number" id="alvoDiario" name="alvoDiario" min="1" value="1">
                            </div>
                            <div class="campo-grupo campo-medio">
                                <label for="unidadeHabito">Unidade</label>
                                <input type="text" id="unidadeHabito" name="unidadeHabito" placeholder="Ex: litros, páginas">
                            </div>
                        </div>
                    </div>

                    <div class="form-secao">
                        <h3 class="form-secao-titulo">Frequência</h3>
                        <div class="campo-grupo">
                            <select id="tipoFrequencia" name="tipoFrequencia" required>
                                <option value="diario">Todos os dias</option>
                                <option value="x-semana">X vezes por semana</option>
                                <option value="x-mes">X vezes por mês</option>
                                <option value="x-em-y">Personalizado...</option>
                            </select>
                        </div>
                        
                        <div class="campos-frequencia-dinamica" id="camposFrequenciaDinamica">
                            <div class="campos-linha campos-x-semana" id="camposXSemana" style="display: none;">
                                <div class="campo-grupo campo-pequeno">
                                    <label for="vezesXSemana">Vezes</label>
                                    <input type="number" id="vezesXSemana" min="1" max="7" value="3">
                                </div>
                                <span class="campo-complemento">vezes por semana</span>
                            </div>
                            
                            <div class="campos-linha campos-x-mes" id="camposXMes" style="display: none;">
                                <div class="campo-grupo campo-pequeno">
                                    <label for="vezesXMes">Vezes</label>
                                    <input type="number" id="vezesXMes" min="1" max="31" value="10">
                                </div>
                                <span class="campo-complemento">vezes por mês</span>
                            </div>
                            
                            <div class="frequencia-personalizada-info" id="frequenciaPersonalizadaInfo" style="display: none;">
                                <span class="frequencia-personalizada-texto" id="frequenciaPersonalizadaTexto">3 vezes em 5 dias</span>
                                <button type="button" class="btn-texto" id="btnEditarFrequenciaXY">Alterar</button>
                            </div>
                        </div>
                    </div>

                    <div class="form-secao">
                        <h3 class="form-secao-titulo">Lembretes</h3>
                        
                        <div class="lembrete-toggle-container">
                            <label class="toggle-switch">
                                <input type="checkbox" id="lembreteAtivo" name="lembreteAtivo">
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="toggle-label" id="lembreteLabel">Desabilitado</span>
                        </div>

                        <div class="lembrete-config" id="lembreteConfig" style="display: none;">
                            <div class="campo-grupo">
                                <label for="horaLembrete">Horário do lembrete</label>
                                <input type="time" id="horaLembrete" name="horaLembrete" value="08:00">
                            </div>
                            
                            <div class="dias-semana-container">
                                <div class="dias-semana-header">
                                    <span>Dias da semana</span>
                                    <button type="button" class="btn-texto" id="btnToggleDias">Selecionar todos</button>
                                </div>
                                <div class="dias-semana-grid" id="diasSemanaGrid">
                                    <button type="button" class="dia-semana-btn" data-dia="dom">Dom</button>
                                    <button type="button" class="dia-semana-btn" data-dia="seg">Seg</button>
                                    <button type="button" class="dia-semana-btn" data-dia="ter">Ter</button>
                                    <button type="button" class="dia-semana-btn" data-dia="qua">Qua</button>
                                    <button type="button" class="dia-semana-btn" data-dia="qui">Qui</button>
                                    <button type="button" class="dia-semana-btn" data-dia="sex">Sex</button>
                                    <button type="button" class="dia-semana-btn" data-dia="sab">Sáb</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-secao">
                        <h3 class="form-secao-titulo">Cor</h3>
                        <div class="cores-grid" id="coresGrid">
                            <label class="cor-opcao">
                                <input type="radio" name="corHabito" value="#10b981" checked>
                                <span class="cor-preview" style="background-color: #10b981"></span>
                            </label>
                            <label class="cor-opcao">
                                <input type="radio" name="corHabito" value="#f59e0b">
                                <span class="cor-preview" style="background-color: #f59e0b"></span>
                            </label>
                            <label class="cor-opcao">
                                <input type="radio" name="corHabito" value="#6366f1">
                                <span class="cor-preview" style="background-color: #6366f1"></span>
                            </label>
                            <label class="cor-opcao">
                                <input type="radio" name="corHabito" value="#8b5cf6">
                                <span class="cor-preview" style="background-color: #8b5cf6"></span>
                            </label>
                            <label class="cor-opcao">
                                <input type="radio" name="corHabito" value="#3b82f6">
                                <span class="cor-preview" style="background-color: #3b82f6"></span>
                            </label>
                            <label class="cor-opcao">
                                <input type="radio" name="corHabito" value="#ec4899">
                                <span class="cor-preview" style="background-color: #ec4899"></span>
                            </label>
                            <label class="cor-opcao">
                                <input type="radio" name="corHabito" value="#14b8a6">
                                <span class="cor-preview" style="background-color: #14b8a6"></span>
                            </label>
                            <label class="cor-opcao">
                                <input type="radio" name="corHabito" value="#ef4444">
                                <span class="cor-preview" style="background-color: #ef4444"></span>
                            </label>
                        </div>
                    </div>

                    <div class="form-acoes">
                        <button type="button" class="btn-secundario" id="btnCancelarHabito">Cancelar</button>
                        <button type="submit" class="btn-primario" id="btnSalvarHabito">Salvar Hábito</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- MODAL: FREQUÊNCIA PERSONALIZADA -->
    <div class="modal-backdrop" id="modalFrequenciaXYBackdrop">
        <div class="modal modal-pequeno" role="dialog" aria-labelledby="tituloModalFrequenciaXY" aria-modal="true">
            <div class="modal-header">
                <h2 id="tituloModalFrequenciaXY">Frequência Personalizada</h2>
                <button type="button" class="btn-fechar-modal" id="btnFecharModalFrequenciaXY" aria-label="Fechar modal">
                    &times;
                </button>
            </div>
            <div class="modal-body">
                <p class="modal-descricao">Defina quantas vezes você quer completar este hábito:</p>
                <div class="frequencia-xy-container">
                    <input type="number" id="inputVezesX" min="1" value="3" class="input-frequencia">
                    <span class="frequencia-texto">vezes em</span>
                    <input type="number" id="inputDiasY" min="1" value="5" class="input-frequencia">
                    <span class="frequencia-texto">dias</span>
                </div>
                <p class="frequencia-exemplo" id="frequenciaExemplo">Exemplo: Completar 3 vezes a cada 5 dias</p>
                <div class="form-acoes">
                    <button type="button" class="btn-secundario" id="btnCancelarFrequenciaXY">Cancelar</button>
                    <button type="button" class="btn-primario" id="btnConfirmarFrequenciaXY">Confirmar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="toast-container" id="toastContainer" role="status" aria-live="polite" aria-atomic="true"></div>

    <!-- MODAL: PREFERÊNCIAS -->
    <div class="modal-backdrop" id="modalPreferenciasBackdrop">
        <div class="modal modal-pequeno" role="dialog" aria-labelledby="tituloModalPreferencias" aria-modal="true">
            <div class="modal-header">
                <h2 id="tituloModalPreferencias">Preferências</h2>
                <button type="button" class="btn-fechar-modal" id="btnFecharPreferencias" aria-label="Fechar modal">
                    &times;
                </button>
            </div>
            <div class="modal-body">
                <div class="pref-list">
                    <div class="pref-item">
                        <div class="pref-item-header">
                            <div class="pref-item-texto">
                                <div class="pref-item-titulo">
                                    Modo escuro
                                    <span class="pref-item-info" tabindex="0" data-info="O tema será aplicado automaticamente em todas as páginas.">i</span>
                                </div>
                                <p class="pref-item-descricao">O tema será aplicado automaticamente em todas as páginas.</p>
                            </div>
                            <div class="toggle-switch" id="toggleModoEscuro" role="switch" aria-checked="false" tabindex="0">
                                <div class="toggle-switch-slider"></div>
                            </div>
                        </div>
                    </div>

                    <div class="pref-item">
                        <div class="pref-item-header">
                            <div class="pref-item-texto">
                                <div class="pref-item-titulo">
                                    Orientação dos dias
                                    <span class="pref-item-info" tabindex="0" data-info="Quando ativado, o mini calendário começa pelo dia atual à esquerda e mostra os dias anteriores à direita.">i</span>
                                </div>
                                <p class="pref-item-descricao">Quando ativado, o mini calendário começa pelo dia atual à esquerda e mostra os dias anteriores à direita.</p>
                            </div>
                            <div class="toggle-switch" id="toggleOrientacaoDias" role="switch" aria-checked="false" tabindex="0">
                                <div class="toggle-switch-slider"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: ESTATÍSTICAS DO HÁBITO -->
    <div class="modal-backdrop" id="modalStatsBackdrop">
        <div class="modal modal-medio" role="dialog" aria-labelledby="tituloModalStats" aria-modal="true">
            <div class="modal-header">
                <h2 id="tituloModalStats">Estatísticas: <span id="statsHabitoNome">Hábito</span></h2>
                <button type="button" class="btn-fechar-modal" id="btnFecharStats" aria-label="Fechar modal">
                    &times;
                </button>
            </div>
            <div class="modal-body">
                <div class="stats-grid">
                    <div class="stats-item">
                        <div class="stats-item-valor" id="statsDiasConcluidos">0</div>
                        <div class="stats-item-label">Dias Concluídos</div>
                    </div>
                    <div class="stats-item">
                        <div class="stats-item-valor" id="statsStreakMaxima">0</div>
                        <div class="stats-item-label">Maior Sequência</div>
                    </div>
                </div>
                
                <div class="stats-secao-titulo">
                    Tipo de hábito
                    <span class="stats-tipo-badge" id="statsTipoBadge">Sim/Não</span>
                </div>
                
                <div class="stats-secao" id="statsSecaoMensuravel" style="display: none;">
                    <h4 class="stats-secao-titulo">Estatísticas de Valores</h4>
                    <div class="stats-grid">
                        <div class="stats-item">
                            <div class="stats-item-valor" id="statsMedia">0</div>
                            <div class="stats-item-label">Média</div>
                        </div>
                        <div class="stats-item">
                            <div class="stats-item-valor" id="statsMaximo">0</div>
                            <div class="stats-item-label">Máximo</div>
                        </div>
                        <div class="stats-item">
                            <div class="stats-item-valor" id="statsMinimo">0</div>
                            <div class="stats-item-label">Mínimo</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-acoes">
                    <button type="button" class="btn-primario" id="btnFecharModalStats">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="assets/js/main.js"></script>
</body>
</html>
